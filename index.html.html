<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Inovera Creation - Professional Billing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* আপনার অরিজিনাল সিএসএস স্টাইল */
        :root { --primary: #f28c28; --bg: #fffbf5; --red: #d32f2f; --green: #27ae60; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #e0e0e0; padding: 20px; }
        
        .top-search-bar { max-width: 850px; margin: 0 auto 15px; background: #333; color: white; padding: 15px; border-radius: 8px; text-align: center; }
        #main-search { width: 60%; padding: 10px; border-radius: 5px; border: none; }
        .controls { max-width: 850px; margin: 0 auto 20px; background: white; padding: 15px; border-radius: 8px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* ইনভয়েস কন্টেইনার */
        .invoice-container { max-width: 800px; margin: auto; background: white; padding: 40px; min-height: 1050px; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.2); box-sizing: border-box; }
        .page-break { page-break-before: always; margin-top: 50px; border-top: 2px dashed #ccc; padding-top: 20px; }

        /* টেবিল এবং ইনপুট ডিজাইন */
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid var(--primary); padding: 8px; font-size: 14px; }
        th { background: var(--bg); }
        input, textarea, select { width: 100%; border: none; outline: none; background: transparent; font-family: inherit; }
        
        #seal-container { position: absolute; width: 120px; cursor: move; z-index: 100; top: 800px; left: 600px; user-select: none; }
        #seal-img { width: 100%; opacity: 0.8; }
        
        button { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; color: white; font-weight: bold; }

        @media print { 
            .no-print, .top-search-bar, .controls { display: none !important; }
            .invoice-container { box-shadow: none; width: 100%; padding: 0; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="top-search-bar no-print">
        <input type="text" id="main-search" placeholder="Search Invoice..." onkeyup="globalSearch()">
        <div id="search-results"></div>
    </div>

    <div class="controls no-print">
        <button onclick="document.getElementById('logo-input').click()" style="background:#555;">Logo</button>
        <button onclick="document.getElementById('seal-input').click()" style="background:#777;">Seal</button>
        <button onclick="addRow()" style="background:var(--green);">+ Item</button>
        <button onclick="saveInvoice()" style="background:#3498db;">Save Record</button>
        <button onclick="downloadManager('pdf')" style="background:#9b59b6;">Download PDF</button>
        <button onclick="downloadManager('jpg')" style="background:#e67e22;">Save JPG</button>
        <button onclick="location.reload()" style="background:var(--red);">Reset</button>
        <input type="file" id="logo-input" accept="image/*" style="display:none">
        <input type="file" id="seal-input" accept="image/*" style="display:none">
    </div>

    <div class="invoice-container" id="printable-area">
        <div id="invoice-page-only">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h1 style="font-size: 40px; margin:0; color: #333;">INVOICE</h1>
                <img id="logo-preview" src="https://via.placeholder.com/150x50?text=Logo" style="max-width:150px;">
            </div>

            <div id="seal-container">
                <img id="seal-img" src="https://via.placeholder.com/120x120?text=Digital+Seal">
            </div>

            <div style="display: flex; justify-content: space-between; background: var(--bg); padding: 10px; margin-bottom: 20px; border-top: 3px solid var(--primary);">
                <div><strong>Inv No:</strong> <input type="text" id="inv-no" value="IC-2026-001" style="width:100px;"></div>
                <div><strong>Date:</strong> <input type="text" id="inv-date"></div>
            </div>

            <table>
                <tr><td><strong>Name:</strong></td><td><input type="text" id="c-name" placeholder="Client Name" oninput="showSummary(this.value)"></td></tr>
            </table>

            <table id="item-table">
                <thead><tr><th>SL</th><th>Description</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
                <tbody id="tbody"></tbody>
            </table>

            <div style="margin-left: auto; width: 40%;">
                <table>
                    <tr><td align="right">Sub Total:</td><td><input type="number" id="sub-total" readonly></td></tr>
                    <tr><td align="right">Advance:</td><td><input type="number" id="advance" value="0" oninput="calculate()"></td></tr>
                    <tr style="background:var(--bg);"><td align="right"><strong>Due:</strong></td><td><input type="number" id="due" readonly style="font-weight:bold;"></td></tr>
                </table>
            </div>
            <p><strong>In Words:</strong> <span id="words-area"></span></p>
        </div>

        <div id="summary-page" class="page-break" style="display:none;">
            <div style="text-align: center; font-weight: bold; font-size: 18px; color: var(--primary); margin-bottom: 10px;">Outstanding Balance Summary</div>
            <div id="sum-content">
                <table border="1" width="100%">
                    <thead><tr><th>Inv No</th><th>Date</th><th>Total</th><th>Paid</th><th>Due</th></tr></thead>
                    <tbody id="sum-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ক্যালকুলেশন এবং ডাটা লজিক
        document.getElementById('inv-date').value = new Date().toLocaleDateString('en-GB');

        function addRow() {
            const tbody = document.getElementById('tbody');
            const row = tbody.insertRow();
            row.innerHTML = `<td>${tbody.rows.length}</td><td><textarea oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea></td><td><input type="number" class="qty" oninput="updateRow(this)"></td><td><input type="number" class="price" oninput="updateRow(this)"></td><td><input type="number" class="row-total" readonly></td>`;
        }

        function updateRow(el) {
            const row = el.closest('tr');
            const q = row.querySelector('.qty').value || 0;
            const p = row.querySelector('.price').value || 0;
            row.querySelector('.row-total').value = (q * p).toFixed(2);
            calculate();
        }

        function calculate() {
            let total = 0;
            document.querySelectorAll('.row-total').forEach(i => total += parseFloat(i.value) || 0);
            document.getElementById('sub-total').value = total.toFixed(2);
            document.getElementById('due').value = (total - (document.getElementById('advance').value || 0)).toFixed(2);
        }

        // পিডিএফ এবং জেপিজি ডাউনলোড কন্ট্রোল (নতুন ফিচার)
        async function downloadManager(format) {
            const mode = prompt("পছন্দ করুন:\n1 = শুধুমাত্র ইনভয়েস (Page 1)\n2 = শুধুমাত্র সামারি (Page 2)\n3 = উভয় পেজ");
            const element = document.getElementById('printable-area');
            const page1 = document.getElementById('invoice-page-part');
            const page2 = document.getElementById('summary-page');

            // পেজ সিলেকশন লজিক
            if (mode === '1') { page2.style.display = 'none'; } 
            else if (mode === '2') { document.getElementById('invoice-page-only').style.display = 'none'; page2.style.display = 'block'; }
            else { page2.style.display = 'block'; }

            if (format === 'pdf') {
                const opt = { margin: 0, filename: 'Inovera_Bill.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
                await html2pdf().set(opt).from(element).save();
            } else {
                // JPG এর জন্য হাই-কোয়ালিটি রেন্ডারিং
                const canvas = await html2canvas(element, { scale: 3, useCORS: true, backgroundColor: "#ffffff" });
                const link = document.createElement('a');
                link.download = 'Inovera_Invoice.jpg';
                link.href = canvas.toDataURL("image/jpeg", 1.0);
                link.click();
            }

            // আগের অবস্থায় ফেরত আনা
            document.getElementById('invoice-page-only').style.display = 'block';
            if(!document.getElementById('c-name').value) page2.style.display = 'none';
        }

        // সিল ড্র্যাগিং লজিক
        const seal = document.getElementById("seal-container");
        let isDragging = false;
        seal.onmousedown = () => isDragging = true;
        document.onmousemove = (e) => { if(isDragging) { seal.style.left = (e.pageX - 60) + "px"; seal.style.top = (e.pageY - 60) + "px"; } };
        document.onmouseup = () => isDragging = false;

        window.onload = () => addRow();
    </script>
</body>
</html>
