<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Inovera Creation - Ultimate Billing System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root {
    --primary:#f28c28;
    --bg:#fffbf5;
    --red:#d32f2f;
    --green:#27ae60;
}

body{
    font-family:'Segoe UI',Arial;
    background:#e0e0e0;
    padding:20px;
}

#login-screen{
    position:fixed;
    inset:0;
    background:#222;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
}
.login-box{
    background:#333;
    padding:30px;
    border-radius:10px;
    color:#fff;
    text-align:center;
}
.login-box input{
    padding:10px;
    width:200px;
    margin:10px;
    border:none;
    border-radius:5px;
}

.top-search-bar{
    max-width:850px;
    margin:0 auto 15px;
    background:#333;
    padding:15px;
    border-radius:8px;
    text-align:center;
}
#main-search{
    width:60%;
    padding:10px;
    border:none;
    border-radius:5px;
}

#search-results{
    background:#fff;
    max-width:600px;
    margin:10px auto 0;
    box-shadow:0 10px 20px rgba(0,0,0,.3);
}
.search-item{
    padding:10px;
    cursor:pointer;
    border-bottom:1px solid #eee;
}
.search-item:hover{background:#f5f5f5}

.controls{
    max-width:850px;
    margin:0 auto 20px;
    background:#fff;
    padding:15px;
    border-radius:8px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
}

button{
    padding:8px 15px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    color:#fff;
    font-weight:bold;
}

.invoice-container{
    max-width:800px;
    margin:auto;
    background:#fff;
    padding:40px;
    min-height:1050px;
    box-shadow:0 0 20px rgba(0,0,0,.2);
    position:relative;
}

table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    border:1px solid var(--primary);
    padding:8px;
    font-size:14px;
}
th{background:var(--bg)}
input,textarea,select{
    width:100%;
    border:none;
    outline:none;
    background:transparent;
}

#seal-container{
    position:absolute;
    width:120px;
    top:800px;
    left:600px;
    cursor:move;
}
#seal-img{width:100%;opacity:.8}

.page-break{
    page-break-before:always;
    margin-top:40px;
}

.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
    z-index:10000;
}
.modal-content{
    background:#fff;
    width:320px;
    margin:15% auto;
    padding:20px;
    border-radius:10px;
    text-align:center;
}

@media print{
    .no-print,.top-search-bar,.controls,#login-screen{display:none!important}
    body{background:#fff}
    .invoice-container{box-shadow:none}
}
</style>
</head>

<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color:var(--primary)">System Access</h2>
        <input type="password" id="sys-pass" placeholder="পাসওয়ার্ড দিন">
        <br>
        <button style="background:var(--primary)" onclick="checkLogin()">Login</button>
    </div>
</div>

<div id="main-content" style="display:none">

<div class="top-search-bar no-print">
    <input id="main-search" placeholder="Search by Client Name or Invoice No" onkeyup="globalSearch()">
    <div id="search-results"></div>
</div>

<div class="controls no-print">
    <button style="background:#555" onclick="logoInput.click()">Logo</button>
    <button style="background:#777" onclick="sealInput.click()">Seal</button>
    <button style="background:var(--green)" onclick="addRow()">+ Item</button>
    <button style="background:#3498db" onclick="saveInvoice()">Save</button>
    <button style="background:#9b59b6" onclick="downloadAction('pdf')">PDF</button>
    <button style="background:#e67e22" onclick="downloadAction('jpg')">JPG</button>
    <button style="background:var(--red)" onclick="deleteInvoice()">Delete</button>
    <button style="background:#555" onclick="openSettings()">Settings</button>
    <button style="background:#7f8c8d" onclick="location.reload()">Logout</button>

    <input type="file" id="logoInput" hidden>
    <input type="file" id="sealInput" hidden>
</div>

<div class="invoice-container" id="printable-area">

<h1>INVOICE</h1>
<img id="logo-preview" src="https://via.placeholder.com/150x50">

<div id="seal-container">
    <img id="seal-img" src="https://via.placeholder.com/120">
</div>

<table>
<tr>
<td>Invoice No</td>
<td><input id="inv-no" value="IC-2026-001"></td>
<td>Date</td>
<td><input id="inv-date"></td>
</tr>
<tr>
<td>Client Name</td>
<td colspan="3"><input id="c-name"></td>
</tr>
</table>

<table id="item-table">
<thead>
<tr><th>SL</th><th>Description</th><th>Qty</th><th>Price</th><th>Total</th></tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<table style="width:40%;margin-left:auto">
<tr><td>Sub Total</td><td><input id="sub-total" readonly></td></tr>
<tr><td>Advance</td><td><input id="advance" value="0" oninput="calculate()"></td></tr>
<tr><td><b>Due</b></td><td><input id="due" readonly></td></tr>
</table>

<p><b>In Words:</b> <span id="words-area"></span></p>

<p style="text-align:center;font-size:12px;color:#888">
Powered by <span id="powered-text">Inovera Creation</span>
</p>

</div>
</div>

<div class="modal" id="settings-modal">
<div class="modal-content">
<h3>Settings</h3>
<input id="new-sys-pass" placeholder="Login Password">
<input id="new-admin-pass" placeholder="Delete Password">
<input id="powered-input" placeholder="Powered By Text">
<br><br>
<button style="background:var(--green)" onclick="saveSettings()">Save</button>
<button style="background:var(--red)" onclick="closeSettings()">Close</button>
</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import {getDatabase,ref,set,get,child,remove} from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

const app=initializeApp({
apiKey:"AIzaSyD564XNDplN4_1YACVsGSPejchc3XMIB20",
databaseURL:"https://special-inventon-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

window.checkLogin=async()=>{
const p=document.getElementById('sys-pass').value;
const s=await get(child(ref(db),'settings/passwords'));
if(p==(s.exists()?s.val().login:"1234")){
login-screen.style.display='none';
main-content.style.display='block';
}else alert("Wrong Password");
};

window.saveSettings=()=>{
set(ref(db,'settings/passwords'),{
login:new-sys-pass.value,
admin:new-admin-pass.value,
powered:powered-input.value
});
alert("Saved");
};

window.globalSearch=()=>{
const q=main-search.value.toLowerCase();
if(!q){search-results.innerHTML="";return;}
get(child(ref(db),'invoices')).then(s=>{
let h="";
for(let i in s.val()){
let m=s.val()[i];
if(m.name.toLowerCase().includes(q)||m.invNo.toLowerCase().includes(q))
h+=`<div class="search-item" onclick="loadInv('${i}')">${m.invNo} - ${m.name}</div>`;
}
search-results.innerHTML=h||"No Result";
});
};

window.downloadAction=(t)=>{
html2canvas(printable-area,{backgroundColor:'#fff',scale:2}).then(c=>{
let a=document.createElement('a');
a.href=c.toDataURL('image/jpeg',1);
a.download='Invoice.'+(t=='pdf'?'jpg':'jpg');
a.click();
});
};

window.onload=()=>addRow();
</script>

<script>
function addRow(){
let r=tbody.insertRow();
r.innerHTML=`<td>${tbody.rows.length}</td>
<td><textarea></textarea></td>
<td><input type=number oninput="calculate()"></td>
<td><input type=number oninput="calculate()"></td>
<td><input readonly></td>`;
}
function calculate(){
let t=0;
[...tbody.rows].forEach(r=>{
let q=r.cells[2].firstChild.value||0;
let p=r.cells[3].firstChild.value||0;
r.cells[4].firstChild.value=q*p;
t+=q*p;
});
sub-total.value=t;
due.value=t-(advance.value||0);
words-area.innerText=t+" Taka Only";
}
</script>

</body>
</html>
